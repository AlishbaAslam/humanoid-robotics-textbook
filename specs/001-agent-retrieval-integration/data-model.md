# Data Model: Agent Development with Retrieval Integration

## Entities

### Query
**Description**: User input requesting information about humanoid robotics content

**Fields**:
- `id` (string, required): Unique identifier for the query
- `text` (string, required): The actual query text from the user
- `timestamp` (datetime, required): When the query was submitted
- `user_id` (string, optional): Identifier for the user making the query
- `session_id` (string, optional): Session identifier for maintaining conversation context

**Validation Rules**:
- `text` must be 1-1000 characters
- `text` must not be empty or whitespace only
- `timestamp` must be within the last 24 hours

### Retrieved Chunk
**Description**: Segments of book content retrieved from Qdrant based on vector similarity to the query

**Fields**:
- `id` (string, required): Unique identifier for the chunk
- `content` (string, required): The text content of the chunk
- `source_document` (string, required): Reference to the original document/chapter
- `page_number` (integer, optional): Page number in the original document
- `similarity_score` (float, required): How similar this chunk is to the query (0.0-1.0)
- `metadata` (dict, optional): Additional metadata about the chunk

**Validation Rules**:
- `content` must be 10-5000 characters
- `similarity_score` must be between 0.0 and 1.0
- `source_document` must not be empty

### Agent Response
**Description**: The final output generated by the agent incorporating retrieved information

**Fields**:
- `id` (string, required): Unique identifier for the response
- `query_id` (string, required): Reference to the original query
- `content` (string, required): The agent's response to the user
- `retrieved_chunks` (list, required): List of chunks used to generate the response
- `timestamp` (datetime, required): When the response was generated
- `confidence` (float, optional): Confidence level in the response (0.0-1.0)
- `sources` (list, optional): List of source documents referenced

**Validation Rules**:
- `content` must be 10-10000 characters
- `retrieved_chunks` must contain at least 1 chunk
- `confidence` must be between 0.0 and 1.0 if provided

### Vector Embedding
**Description**: Mathematical representation of text content used for similarity matching in Qdrant

**Fields**:
- `id` (string, required): Unique identifier for the embedding
- `text_content` (string, required): The original text that was embedded
- `vector` (list[float], required): The numerical vector representation
- `document_id` (string, required): Reference to the source document
- `chunk_index` (integer, required): Position of this chunk in the document

**Validation Rules**:
- `vector` must have consistent dimensionality (typically 384, 768, or 1536 elements depending on model)
- `text_content` must not be empty
- `chunk_index` must be non-negative

## Relationships

### Query → Agent Response
- One-to-one relationship (each query generates one response)
- Query is the parent entity
- Agent Response references the query via `query_id`

### Query → Retrieved Chunk
- One-to-many relationship (one query can retrieve multiple chunks)
- Through the Agent Response which contains the retrieved chunks
- Agent Response aggregates the relevant chunks for the query

### Retrieved Chunk → Vector Embedding
- One-to-one relationship (each chunk has one corresponding embedding)
- Retrieved Chunk references the embedding via metadata
- Embedding contains the vector representation of the chunk's content

## State Transitions

### Query Processing States
- `PENDING`: Query received but not yet processed
- `PROCESSING`: Query is being processed (retrieval and generation in progress)
- `COMPLETED`: Response successfully generated and returned
- `FAILED`: Error occurred during processing

### Lifecycle
1. Query enters `PENDING` state when received via API
2. Query transitions to `PROCESSING` when retrieval begins
3. Retrieved chunks are identified and used for response generation
4. Query transitions to `COMPLETED` when response is returned
5. Query transitions to `FAILED` if any error occurs during processing